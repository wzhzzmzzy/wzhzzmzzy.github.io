<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    拭微
</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://wzhzzmzzy.github.io">
<link rel="dns-prefetch" href="https://cdn.bootcss.com">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="Amber">
<meta name="description" content="一直尝试变得更有趣的阿宅">
<meta name="keywords" content="">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/css/style.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/cdn/main.css" />
<!--<link rel="stylesheet" href="https://wzhzzmzzy.github.io/media/css/style.min.css" />
<link rel="stylesheet" href="https://wzhzzmzzy.github.io/styles/main.css" />-->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.0/dist/APlayer.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.0/dist/APlayer.min.css">
    
        <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/icon.min.js"></script>
        <!--<script src="https://wzhzzmzzy.github.io/media/script/tocbot.min.js"></script>
        <script src="https://wzhzzmzzy.github.io/media/script/script.min.js"></script>
        <script src="https://wzhzzmzzy.github.io/media/script/icon.min.js"></script>-->
        <script src="https://cdn.bootcss.com/highlight.js/9.13.1/highlight.min.js"></script>
        <link href="https://cdn.bootcss.com/highlight.js/9.13.1/styles/atelier-estuary-dark.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
        
            <script>
                (function() {
                    var bp = document.createElement('script');
                    var curProtocol = window.location.protocol.split(':')[0];
                    if (curProtocol === 'https') {
                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                    } else {
                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                    }
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>
            
                
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://wzhzzmzzy.github.io">
                    拭微
                </a>
            </div>

            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        首页
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        归档
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        标签
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        关于
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1579927857513" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://wzhzzmzzy.github.io">
                            拭微
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;\u6697\u9ED1</a>
                    </div>
                    <form id="gridea-search-form" data-update="1579927857513" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            首页
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            归档
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            标签
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            关于
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Python 科学计算 —— NumPy
                            </h1>
                            <!--en-->
                            <div class="post-meta en">
                                Author:
                                <a itemprop="author" rel="author" href="/">
                                    拭微
                                </a>
                                <span class="post-time">
                                Date: <a href="#">2017-09-08</a>
                            </span>
                                <span class="post-readtime">Reading Time:<a href="#">21.8 mins</a></span>
                                <span class="post-words">words:<a href="#">5523</a></span>
                                
                                    <span class="post-category">
                                Category:
                                
                                <a href="https://wzhzzmzzy.github.io/tag/51IC-yyFuX">Python</a>
                                
                            </span>
                                    
                            </div>
                            <!--zh-->
                            <div class="post-meta zh">
                                &#x4F5C;&#x8005;:
                                <a itemprop="author" rel="author" href="/">
                                    拭微
                                </a>
                                <span class="post-time">&#x65E5;&#x671F;: <a href="#">2017-09-08</a></span>
                                <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a href="#">21.8 &#x5206;&#x949F;</a></span>
                                <span class="post-words">&#x5B57;&#x6570;:<a href="#">5523</a></span>
                                
                                    <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://wzhzzmzzy.github.io/tag/51IC-yyFuX">Python</a>
                                
                            </span>
                                    
                            </div>
                        </header>
                        <div class="post-content">
                            <h3 id="numpy">NumPy</h3>
<pre><code class="language-python">import numpy as npv
np.__version__ # 版本号
</code></pre>
<h4 id="nbarray-对象">nbarray 对象</h4>
<p>NumPy中用<code>ndarray</code>表示数组，是整个库的核心对象，NumPy中所有函数都是围绕<code>ndarray</code>对象进行处理的。<code>ndarray</code>的结构并不复杂，但是功能十分强大。不但可以用它高效地存储大量的数值元素，从而提高数值计算的运算速度，还能用它与各种扩展库进行数值交换。</p>
<h5 id="创建">创建</h5>
<p>创建数组很简单。</p>
<pre><code class="language-python">a = np.array([1,2,3,4])
b = np.array([[1,2,3,4],[5,6,7,8]])
</code></pre>
<p>数组的形状可以由<code>shape</code>属性获得，是一个描述数组各个轴长度的元组。可以通过修改<code>shape</code>属性值来对数组进行重新划分。</p>
<pre><code class="language-python">a.shape # (4,)
b.shape # (2, 4)

a.shape = 2, 2 # a array([[1,2],[3,4]])
b.shape = 4, -1 # b array([[1,2],[3,4],[5,6],[7,8]])
</code></pre>
<p>可以使用数组的<code>reshape()</code>方法，来根据原数组创建新数组。</p>
<h5 id="元素类型">元素类型</h5>
<p>数组的元素类型可以通过<code>dtype</code>属性获得。在前面的例子中，创建数组所用的序列的元素都是整数，因此所创建的数组的元素类型是整形，并且是32位的长整型。<code>dtype.type</code>可以获取<code>type</code>类型的对象。</p>
<pre><code class="language-python">a.dtype # dtype('int64')
a.dtype.type # &lt;type 'numpy.int64'&gt;
</code></pre>
<p>可以通过<code>dtype</code>参数在创建数组时指定元素类型，注意<code>float</code>类型是64位的双精度浮点类型，而<code>complex</code>是128位的双精度复数类型，<code>np.int32</code>则是NumPy`定义的新的数据类型——32位符号整数类型：</p>
<pre><code class="language-python">ai32 = np.array([1,2,3,4], dtype=np.int32)
af = np.array([1,2,3,4], dtype=float)
ac = np.array([1,2,3,4], dtype=complex)
</code></pre>
<p>NumPy也有自己的浮点数类型：<code>float16</code>，<code>float32</code>，<code>float64</code>，<code>float128</code>。当使用<code>float64</code>作为<code>dtype</code>参数时，效果和内置的<code>float</code>类型相同。</p>
<p>每种元素数值类型都有几种不同的字符串表达方式，字符串和类型之间的对应关系都存储在<code>typeDict</code>字典中，可以通过下面的命令获得对应的所有键值：</p>
<pre><code class="language-python">[key for key, value in np.typeDict.items() if value is np.float64]
# [12, 'd', 'float64', 'float_', 'float', 'f8', 'double', 'Float64']
</code></pre>
<p>完整的类型列表可以通过下面的语句得到，它将<code>typeDict</code>字典中的所有制转换为一个集合，从而去除其中的重复项。</p>
<pre><code class="language-python">set(np.typeDict.values())
</code></pre>
<p>通过NumPy的数值类型也可以创建数值对象，下面创建一个16位的符号整数对象，它与Python的整数对象不同的是，它的范围有限，因此计算<code>200*200</code>会溢出，得到一个负数，这一点与C语言的16位整数相同。</p>
<p>另外值得注意的是，NumPy的数值对象的运算速度比Python内置类型的运算速度慢很多，如果程序中需要大量地对单个数值运算，应当尽量避免使用NumPy的数值对象。下面的命令比较了两者的运算速度：</p>
<pre><code class="language-python">u = 3.14
v = np.float64(u)
%timeit u*u
%timeit v*v
</code></pre>
<p>使用<code>astype()</code>方法可以对数组的元素类型进行转换，下面将浮点数数组<code>t1</code>转换为32为整数数组，将双精度的复数数组<code>t2</code>转换为单精度的复数数组：</p>
<pre><code class="language-python">t1 = np.array([1,2,3,4], dtype=np.float)
t2 = np.array([1,2,3,4], dtype=np.complex)
t3 = t1.astype(np.int32)
t4 = t2.astype(np.complex64)
</code></pre>
<h5 id="自动生成数组">自动生成数组</h5>
<p>前面的例子都是先创建一个Python的序列对象，然后通过<code>np.array()</code>将其转换为数组，这样做显然效率不高。因此NumPy提供了很多专门用于创建数组的函数。下面每一个函数都有一些关键字参数，具体用法参看函数说明。</p>
<p><code>arange()</code>类似于内置函数<code>range()</code>，通过制定开始值、终值和步长来创建表示等差数列的一维数组，注意所得到的结果不包含终值。例如下面的程序创建开始值为0，终值为1，步长为0.1的等差数组，注意终值1不在数组中。</p>
<pre><code class="language-python">np.arange(0, 1, 0.1)
# array([0. , 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9])
</code></pre>
<p><code>linspace()</code>通过制定初值、终值和元素个数来创建表示等差数列的一维数组。可以通过<code>endpoint</code>参数制定是否包含终值，默认值为<code>True</code>，即包含终值。</p>
<pre><code class="language-python">np.linspace(0, 1, 10) # 步长 1/9
np.linspace(0, 1, 10, endpoint=False) # 步长 1/10
</code></pre>
<p><code>logspace()</code>和<code>linspace()</code>类似，不过它所创建的数组是等比数列。下面的例子产生从 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">10^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">10^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>，有5个元素的等比数列，注意起始值0代表 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">10^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span>，而终值2表示 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">10^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>：</p>
<pre><code class="language-python">np.logspace(0, 2, 5)
# [1. , 3.16227766, 10. , 31.6227766 , 100. ]
</code></pre>
<p>基数可以通过<code>base</code>参数确定，其默认值为10。下面通过将<code>base</code>参数设置为2，并设置<code>endpoint</code>参数为<code>False</code>，创建一个比例为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mn>112</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{frac{1}{12}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">c</span><span class="mord mtight"><span class="mord mtight">1</span></span><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span> 的等比数组，此等比数组的比值啥音乐中相差半音的两个音阶之间的频率比值，因此可以用它计算一个八度中所有半音的频率：</p>
<pre><code class="language-python">np.logspace(0, 1, 12, base=2, endpoint=False)
# [ 1.          1.05946309  1.12246205  1.18920712  1.25992105  1.33483985 1.41421356  1.49830708  1.58740105  1.68179283  1.78179744  1.88774863]
</code></pre>
<p><code>zeros()</code>、<code>ones()</code>、<code>empty()</code>可以创建指定形状和类型的数组。其中<code>empty()</code>只分配数组所使用的内存，不对数组元素进行初始化操作，因此它的运行速度是最快的。下面的程序创建一个形状为<code>(2, 3)</code>、元素类型为整数的数组，注意其中的元素值没有被初始化：</p>
<p>而<code>zeros()</code>将数组元素初始化为0，<code>ones()</code>将数组元素初始化为1。下面创建一个长度为4，元素类型为整数的一位数组，并且元素全部初始化为0。</p>
<pre><code class="language-python">np.empty((2,3), np.int)
np.zeros(4, np.int)
np.full(4, np.pi) # 初始化为指定的值
</code></pre>
<p>此外，<code>zeros_like()</code>、<code>ones_like()</code>、<code>empty_like()</code>、<code>full_like()</code>等函数创建与参数数组的形状与类型相同的数组，因此<code>zeros_like(a)</code>和<code>zeros(a.shape, a.dtype)</code>的效果相同。</p>
<p><code>frombuffer()</code>、<code>fromstring()</code>、<code>fromfile()</code>等函数可以从字节序列或文件创建数组。下面以<code>fromstring()</code>为例介绍它们的用法，先创建8个字符的字符串<code>s</code>，Python的字符串实际上是一个字节序列，每个字符占一个字节。因此如果从字符串<code>s</code>创建一个8为整数数组，所得到的数组是字符串的ASCII编码。</p>
<pre><code class="language-python">s = &quot;abcedfg&quot;
np.fromstring(s, dtype=np.int8)
</code></pre>
<p>如果从字符串<code>s</code>创建一个16位整数数组，那么两个相邻的字节就表示一个整数，吧字节98和字节97当作一个16位的整数，他的值就是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>98</mn><mo>×</mo><mn>256</mn><mo>+</mo><mn>97</mn><mo>=</mo><mn>25185</mn></mrow><annotation encoding="application/x-tex">98\times 256+97=25185</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">9</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">9</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">1</span><span class="mord">8</span><span class="mord">5</span></span></span></span>。可以看出，16位的整数啥以低位字节在前的方式保存在内存中的。</p>
<pre><code class="language-python">np.fromstring(s, dtype=np.int16)
# array([25185, 25699, 26213, 26727], dtype=int16)
</code></pre>
<p>如果把整个字符串转化为一个64位的双精度浮点数数组，那么它的值是：</p>
<pre><code class="language-python">np.fromstring(s, dtype=np.float)
# array([8.54088322e+194])
</code></pre>
<p>显然这个结果没有什么意义，但是如果我们用C语言的二进制方式写了一组<code>double</code>类型的数值到某个文件中，那就可以从此文件读取相应的数据，并通过<code>fromstring()</code>将其转换为<code>float64</code>类型的数组，或者直接使用<code>fromfile()</code>从二进制文件读取数据。</p>
<p><code>fromstring()</code>会对字符串的字节序列进行复制，而使用<code>frombuffer()</code>创建的数组与原始字符串共享内存。由于字符串是只读的，因此无法修改所创建的数组的内容：</p>
<pre><code class="language-python">buf = np.frombutter(s, dtype=np.int16)
buf[1] = 10 # ValueError
</code></pre>
<p>Python中还有一些类型也支持<code>buffer</code>接口，例如<code>bytearray</code>、<code>array.array</code>等。在后面的章节中，我们会介绍如何使用这些对象实现动态数组功能。</p>
<p>还可以先定义一个从下标计算数值的函数，然后用<code>fromfunction()</code>通过此函数创建数组：</p>
<pre><code class="language-python">func = lambda i: i%4+1
np.fromfunction(func, (10,))
# [1., 2., 3., 4., 1., 2., 3., 4., 1., 2.]
func = lambda i,j: (i+1)*(j+1)
np.fromfunction(func2, (9,9)) # 九九乘法表
# [[  1.   2.   3.   4.   5.   6.   7.   8.   9.]
# [  2.   4.   6.   8.  10.  12.  14.  16.  18.]
# [  3.   6.   9.  12.  15.  18.  21.  24.  27.]
# [  4.   8.  12.  16.  20.  24.  28.  32.  36.]
# [  5.  10.  15.  20.  25.  30.  35.  40.  45.]
# [  6.  12.  18.  24.  30.  36.  42.  48.  54.]
# [  7.  14.  21.  28.  35.  42.  49.  56.  63.]
# [  8.  16.  24.  32.  40.  48.  56.  64.  72.]
# [  9.  18.  27.  36.  45.  54.  63.  72.  81.]]
</code></pre>
<h4 id="存取元素">存取元素</h4>
<p>可以使用和列表相同的方式对数组的元素进行存取：</p>
<pre><code class="language-python">a = np.arange(10)
a[5] # 5
a[3:5] # [3, 4]
a[:5] # [0, 1, 2, 3, 4]
a[:-1] # [0, 1, 2, 3, 4, 5, 6, 7, 8]
a[1:-1:2] # [1, 3, 5, 7]
a[::-1] # [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
a[5:1:-2] # [5, 3]
</code></pre>
<p>和列表不同的是，通过切片获取的新数组的原始数组的一个试图。它与原始数组共享一块数据存储空间。下面的程序将<code>b</code>的第二个元素修改为-10，<code>a</code>的第5个元素也同时被修改为-10，因此它们在内存中的地址相同。</p>
<p>除了使用切片下标存取元素之外，NumPy还提供了整数列表、整数数组和布尔数组等几种高级下标存取方法。</p>
<p>当使用整数列表对数组元素进行存取时，将使用列表中的每个元素作为下标。使用列表作为下标得到的数组不和原始数组共享内存，整数序列下标也可以用来修改元素的值：</p>
<pre><code class="language-python">x = np.arange(10, 1, -1)
a = x[[3, 3, 1, 8]]
b = x[[3, 3, -3, 8]]
x[[3, 5, 1]] = -1, -2, -3
</code></pre>
<p><strong>当使用整数数组作为数组下标时，将会得到一个形状和下标数组相同的新数组</strong>，新数组的每一个元素都是用下标数组中对应位置的值作为下标从原数组获得的值。当下标数组是一维数组时，结果和用列表作为下标的结果是一样的，而多维数组时，得到的也是多维数组：</p>
<pre><code class="language-python">x = np.aragne(10,1,-1)
x[np.array([3,3,1,8])]
x[np.array([[3,3,1,8],[3,3,-1,8]])]
x[[3,3,1,8,3,3,-1,8]].reshape(2,4) # 和上一句等同
</code></pre>
<p>当使用布尔数组<code>b</code>作为下标存取数组<code>x</code>中的元素时，将获得数组<code>x</code>中与数组<code>b</code>中<code>True</code>对应的元素。使用布尔数组作为下标获得的数组不和原始数组共享数据内存，注意这种方式只对应于布尔数组，不能使用布尔列表。</p>
<pre><code class="language-python">x[np.array([True, False, True, False, False])]
x[np.array([True, False, True])] # 等同
</code></pre>
<p>布尔数组一般不是手工产生，而是使用布尔运算的<code>ufunc</code>函数产生，关于<code>ufunc</code>函数请参照下一节的介绍。下面我们举一些简单的例子说明布尔数组下标的用法：</p>
<pre><code class="language-python">x = np.random.randint(0, 10, 6) # 产生一个长度为6，元素值为0到9的随机整数数组
x[x&gt;5] # 生成一个布尔数组，收集x中所有大于5的数
</code></pre>
<h4 id="多维数组">多维数组</h4>
<p>多维数组的存取和一维数组类似，因为多维数组有多个轴，所以它的下标需要用多个值来表示。NumPy采用元组作为数组的下标，元祖中的每个元素和数组的每个轴对应。</p>
<blockquote>
<p>为什么用元组作为下标？Python的下标语法本身不支持多维，但可以使用任何对象作为下标，因此，NumPy使用元组作为下标存取数组中的元素，使用元组可以很方便地表示多个轴的下标。虽然在Python程序中经常用圆括号将元组的元素括起来，但是事实上元组的语法只需要用逗号隔开元素即可，例如，<code>x,y=y,x</code>就是用元组交换变量值的一个例子。因此，<code>a[1,2]</code>和<code>a[(1,2)]</code>完全相同，都是使用元组<code>(1,2)</code>作为数组<code>a</code>的下标。</p>
</blockquote>
<p>可以通过<code>arange</code>相加可以获取需要的二维数组，这样构成的数组，第0个元素与数组的纵轴对应，而第1个元素和横轴对应：</p>
<pre><code class="language-python">a = np.arange(0, 60, 10).reshape(-1, 1) + np.aragne(0, 6)
a[0] # [0 1 2 3 4 5]
a[1] # [10 11 12 13 14 15]
a[:, 2] # [2 12 22 32 42 52]
a[2::2, ::2] # [[20 22 24] [40 42 44]]
</code></pre>
<p>如果下标元组中只包含整数和切片，那么得到的数组和原始数组共享数据，它是原数组的视图。下面的例子中，数组<code>b</code>是<code>a</code>的视图，它们共享数据，因此修改<code>b[0]</code>时，数组<code>a</code>中对应的元素也被修改。</p>
<pre><code class="language-python">b = a[0, 3:5]
b[0] = -b[0]
a[0, 3:5]
# array([-3, 4])
</code></pre>
<p>因为数组的下标是一个元组，所以我们可以将下标元组保存起来，用同一个元组存取多个数组。在下面的例子中，<code>a[idx]</code>和<code>a[::2,2:]</code>相同，<code>a[idx][idx]</code>和<code>a[::2,2:][::2,2:]</code>。</p>
<pre><code class="language-python">idx = slice(None, None, 2), slice(2, None)
</code></pre>
<blockquote>
<p>切片对象。根据Python的语法，在[]中可以使用以冒号隔开的两个或三个整数表示切片，但是单独生成切片对象时需要使用<code>slice()</code>来创建。它由三个参数，分别为开始值、终值和步长，当这些值需要省略时可以使用<code>None</code>。</p>
</blockquote>
<p>用Python的内置函数<code>slice()</code>创建下标比较麻烦，因此NumPy提供一个<code>s_</code>对象来帮助我们创建数组下标，请注意<code>s_</code>实际上是<code>IndexExpression</code>类的一个对象：</p>
<pre><code class="language-python">np.s_[::2, 2:]
# (slice(None, None, 2), slice(2, None, None))
</code></pre>
<blockquote>
<p>s_为什么不是函数？根据Python的语法，只有在中括号[]中才能使用以冒号隔开的切片语法，如果<code>s_</code>是函数，那么这些切片必须使用<code>slice()</code>创建。类似的对象还有<code>mgrid</code>和<code>ogrid</code>等，后面我们会学习它们的用法。Python的下标语法实际上会调用<code>__getitem__()</code>方法，因此我们可以很容易自己实现<code>s_</code>对象的功能：</p>
</blockquote>
<pre><code class="language-python">class S(object):
    def __getitem__(self, index):
        return index
</code></pre>
<p>在多维数组的下标元组中，也可以使用整数元祖或列表、整数数组和布尔数组。当下标使用这些对象时，所获得的数字是原始数据的副本，因此修改结果数组不会改变原始数组。</p>
<h4 id="结构数组">结构数组</h4>
<p>在C语言中我们可以通过<code>struct</code>关键字定义结构类型，结构中的字段占据连续的内存空间。类型相同的两个结构所占用的内存大小相同，因此可以很容易定义结构数组。和C语言一样，在NumPy中也很容易对这种结构数组进行操作。只要NumPy中的结构定义和C语言中的结构定义相同，就可以很方便地读取C语言的结构数组的二进制数据，将其转换为NumPy的结构数组。</p>
<p>假设我们需要定义一个结构数组，它的每个元素都有<code>name</code>、<code>age</code>和<code>weight</code>字段。在NumPy中可以如下定义：</p>
<pre><code class="language-python">persontype = np.dtype({
    'names':['name', 'age', 'weight'],
    'formats':['S30', 'i', 'f']}, align=True)
a = np.array([(&quot;Zhang&quot;, 32, 75.5), (&quot;Wang&quot;, 24, 65.2)], dtype=persontype)
</code></pre>
<p>我们先创建一个<code>dtype</code>对象<code>persontype</code>，它的参数是一个描述结构类型的各个字段的字典，字典有两个键：<code>'names'</code>和<code>'formats'</code>。每个键对应的值都是一个列表。<code>'names'</code>定义结构中每个字段的名称，而<code>'formats'</code>则定义每个字段的类型。这里我们使用类型字符串定义字段类型。</p>
<ul>
<li><code>'S30'</code>: 长度为30字节的字符串类型，由于结构中每个元素大小必须固定，因此需要制定字符串的长度。</li>
<li><code>'i'</code>：32位整数，相当于<code>np.int32</code>。</li>
<li><code>'f'</code>：32位单精度浮点数类型，相当于<code>np.float32</code>。</li>
</ul>
<p>然后我们调用<code>array()</code>以创建数组，通过<code>dtype</code>参数指定所创建的数组的元素类型为<code>persontype</code>。下面查看数组<code>a</code>的元素类型：</p>
<pre><code class="language-python">a.dtype
# dtype({'names':['name','age','weight'], 'formats':['S30','&lt;i4','&lt;f4'], 'offsets':[0,32,36], 'itemsize':40, 'aligned':True})
</code></pre>
<p>还可以用包含多个元组的列表来描述结构的类型：</p>
<pre><code class="language-python">dtype([('name', '|S30'), ('age', '&lt;i4'), ('weight', '&lt;f4')])
</code></pre>
<p>其中形如“（字段名，类型描述）”的元组描述了结构中的每个字段。类型字符串前面的<code>'I'</code>、<code>'&lt;'</code>、<code>'&gt;'</code>等字符表示字段值的字节顺序：</p>
<ul>
<li><code>'I'</code>：忽视字节顺序。</li>
<li><code>'&lt;'</code>：低位字节在前，即小端模式。</li>
<li><code>'&gt;'</code>：高位字节在前，即大端模式。</li>
</ul>
<p>结构数组的存取方式和一般数组相同，通过下标能够取得其中的元素，注意元素的值看上去像是数组，实际上是结构：</p>
<pre><code class="language-python">print a[0]
a[0].dtype
# ('Zhang', 32, 75.5)
# dtype({'names':['name','age','weight'], 'formats':['S30','&lt;i4','&lt;f4'], 'offsets':[0,32,36], 'itemsize':40, 'aligned':True})
</code></pre>
<p>我们可以使用字段名作为下标获取对应的字段值：</p>
<pre><code class="language-python">a[0]['name']
# 'Zhang'
</code></pre>
<p><code>a[0]</code>是一个结构元素，它和数组<code>a</code>共享内存，因此可以通过修改它的字段改变原始数组中对应元素的字段。我们不但可以获得结构元素的某个字段，而且可以直接获得结构数组的字段，返回的是原始数组的视图，因此可以通过修改<code>b[0]</code>来改变<code>a[0]['age']</code>。</p>
<p>通过<code>a.tostring()</code>或<code>a.tofile()</code>方法，可以将数组<code>a</code>以二进制的方式转换成字符串或者写入文件：</p>
<pre><code class="language-python">a.tofile('test.bin')
</code></pre>
<p>利用下面的C语言程序可以将<code>test.bin</code>文件中的数据读取出来。<br>
vc</p>
<pre><code class="language-c++">struct person {
    char name[30];
    int age;
    float weight;
} p[3];

int main() {
    FILE *fp = fopen(&quot;test.bin&quot;, &quot;rb&quot;);
    fread(p, sizeof person, 2, fp);
    fclose(fp);
    for(int i = 0; i &lt; 2; ++i)
        printf(&quot;%s %d %f\n&quot;, p[i].name, p[i].age, p[i].weight);
}
</code></pre>
<h3 id="ufunc函数"><code>ufunc</code>函数</h3>
<p><code>ufunc</code>相当于Python的<code>map</code>，能对数组的每一个元素执行运算。区别在于返回了一个新数组，并没有改变原数组的值。也可以通过<code>out</code>参数来指定保存计算结果的数组。另一个区别是NumPy的这些<code>ufunc</code>函数都是用C语言实现的，所以比Py2自带的函数用<code>map</code>去实现这样的功能要快十倍以上。</p>
<p>这些函数也支持单个数值的运算，但是在单个数值时会比<code>math</code>库中的函数慢很多。此外，对于单个数值的计算，<code>np.sin()</code>和<code>math.sin</code>返回值类型不同，<code>NumPy</code>的返回值是<code>float64</code>类型。通过下标运算获取的数组元素的类型为NumPy中定义的类型，将其转换为Python的标准类型还需要花费额外的事件。数组提供了<code>item()</code>方法来解决这个问题，用来获取数组中的单个元素，并且直接返回为标准的Python数据类型。</p>
<pre><code class="language-python">x = np.linspace(0, 2*np.pi, 10)
y = np.sin(x, out = x)
y is x # True
</code></pre>
<h4 id="四则运算-比较运算和布尔运算">四则运算、比较运算和布尔运算</h4>
<p>NumPy提供了很多<code>ufunc</code>函数，比如计算两个数组之和的<code>add()</code>函数，还有<code>subtract</code>，<code>multiply</code>等等。</p>
<p>使用<code>==</code>、<code>&gt;</code>等比较运算符对两个数组进行比较，将返回一个布尔数组，它的每个元素值都是两个数组对应元素的比较结果。由于Python中布尔运算使用<code>and</code>、<code>or</code>、<code>not</code>等关键字，无法被重载，因此数组的布尔运算只能通过相应的<code>ufunc</code>函数进行。这些函数名以<code>logical_</code>开头。</p>
<pre><code class="language-python">np.logical_or(a==b, a&gt;b) # 等同于 a &gt;= b
</code></pre>
<p>可以使用数组的<code>any()</code>和<code>all()</code>函数，和Python内置的函数相同。</p>
<p><code>bitwise_</code>开头的是位运算函数。对于布尔数组来说，位运算和布尔运算结果相同，但是使用时位运算的优先级高于布尔运算。整数位运算和C语言位运算相同，注意元素类型的符号。</p>
<h4 id="自定义ufunc函数">自定义<code>ufunc</code>函数</h4>
<p>通过NumPy提供的标准<code>ufunc</code>函数，可以组合出复杂的表达式，在C语言级别对数组的每个元素进行计算。但是有时候这种表达式不易编写，而对每个元素进行计算的程序却很容易用Python实现，这是可以用<code>frompyfunc()</code>将计算单个元素的函数转换成<code>ufunc</code>函数，这样就可以方便地用所产生的<code>ufunc</code>函数对数组进行计算了。</p>
<p>下面是一个计算三角波上某点的Y坐标的函数。</p>
<pre><code class="language-python">def triangle_wave(x, c, c0, hc):
    x = x - int(x)
    if x &gt;= c: r = 0.0
    elif x &lt; c0: r = x / c0 * hc
    else: r = (c-x) / (c-c0) * hc
    return r
</code></pre>
<p>通过<code>frompyfunc()</code>可以将计算单个值的函数转换为能对数组的每个元素进行计算的<code>ufunc</code>函数。值得注意的是，转化之后的函数返回值类型是<code>object</code>，需要用<code>astype</code>方法把它转化为双精度浮点数组。</p>
<pre><code class="language-python">frompyfunc(func, nin, nout) # 函数 传参个数 返回值个数
trignle_wave_ufunc = np.frompyfunc(triagnle_wave, 4, 1)
</code></pre>
<h4 id="广播">广播</h4>
<p>当使用<code>ufunc</code>函数对两个数组进行计算时，<code>ufunc</code>函数会对这两个数组的对应元素进行计算，因此它要求这两个数组的形状相同。如果形状不同，会进行如下广播处理：</p>
<ul>
<li>让所有输入数组都向维数最多的数组看起，不足部分通过加1补齐。</li>
<li>输出数组的<code>shape</code>属性是输入数组的<code>shape</code>属性的各个轴上的最大值。</li>
<li>如果输入数组的某个轴的长为1或与输出数组的对应轴长度相同，这个数组就能够用来计算，否则会报错。</li>
<li>当输入数组的某个轴长度为1时，沿着此轴运算时，都用此轴的第一组值。</li>
</ul>

                        </div>
                        <div class="post-toc">
                            <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#numpy">NumPy</a>
<ul>
<li><a href="#nbarray-%E5%AF%B9%E8%B1%A1">nbarray 对象</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA">创建</a></li>
<li><a href="#%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8B">元素类型</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%95%B0%E7%BB%84">自动生成数组</a></li>
</ul>
</li>
<li><a href="#%E5%AD%98%E5%8F%96%E5%85%83%E7%B4%A0">存取元素</a></li>
<li><a href="#%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84">多维数组</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E6%95%B0%E7%BB%84">结构数组</a></li>
</ul>
</li>
<li><a href="#ufunc%E5%87%BD%E6%95%B0"><code>ufunc</code>函数</a>
<ul>
<li><a href="#%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E5%92%8C%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97">四则运算、比较运算和布尔运算</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89ufunc%E5%87%BD%E6%95%B0">自定义<code>ufunc</code>函数</a></li>
<li><a href="#%E5%B9%BF%E6%92%AD">广播</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                        <section class="post-copyright en">
                            <!--en-->
                            <p class="copyright-item">
                                <span>Author:</span>
                                <span>拭微</span>
                            </p>

                            <p class="copyright-item">
                                <span>Permalink:</span>
                                <span><a href="https://wzhzzmzzy.github.io/post/2017-09-08-Python科学计算">https://wzhzzmzzy.github.io/post/2017-09-08-Python科学计算</a></span>
                            </p>

                            <p class="copyright-item">
                                <span>License:</span>
                                <span>MIT License</span>
                            </p>
                        </section>
                        <section class="post-copyright zh">
                            <!--zh-->
                            <p class="copyright-item ">
                                <span>&#x4F5C;&#x8005;:</span>
                                <span>拭微</span>
                            </p>

                            <p class="copyright-item">
                                <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                <span><a href="https://wzhzzmzzy.github.io/post/2017-09-08-Python科学计算">https://wzhzzmzzy.github.io/post/2017-09-08-Python科学计算</a></span>
                            </p>

                            <p class="copyright-item">
                                <span>&#x534F;&#x8BAE;:</span>
                                <span>MIT License</span>
                            </p>
                        </section>
                        <!--en-->
                        <section class="post-tags en">
                            <div>
                                <span>Tag(s):</span>
                                <span class="tag">
                                
                                
                                <a href="https://wzhzzmzzy.github.io/tag/51IC-yyFuX"># Python</a>
                                
                                
                            </span>
                            </div>
                            <div>
                                <a href="javascript:window.history.back();">back</a>
                                <span>&dot;</span>
                                <a href="#">home</a>
                            </div>
                        </section>
                        <!--zh-->
                        <section class="post-tags zh">
                            <div>
                                <span>&#x6807;&#x7B7E;:</span>
                                <span class="tag">
                                
                                
                                <a href="https://wzhzzmzzy.github.io/tag/51IC-yyFuX"># Python</a>
                                
                                
                            </span>
                            </div>
                            <div>
                                <a href="javascript:window.history.back();">
                                &#x8FD4;&#x56DE;</a>
                                <span>&dot;</span>
                                <a href="#">&#x4E3B;&#x9875;</a>
                            </div>
                        </section>
                        <section class="post-nav">
                            
                                <a class="prev" rel="prev" href="https://wzhzzmzzy.github.io/post/2017-09-14-2013长沙现场赛水题题解">
                                    2013长沙ICPC现场赛水题题解
                                </a>
                                
                                    
                                        <a class="next" rel="next" href="https://wzhzzmzzy.github.io/post/2017-08-19-2017CCPC网络赛记录">
                                            2017 CCPC网络赛记录
                                        </a>
                                        
                        </section>
                    </article>
                </div>
                
            </div>
    </div>
    </div>
    </div>
    
    <div id="player"></div>
    
        <footer id="footer" class="footer">

            <div class="copyright">
                <!-- <div class="Like">
                    <div class="tip" data-tooltip="Do you like it?">
                        <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                    </div>
                </div> -->
                
                    <b id="hitokoto"></b><br>
                    <!-- <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg> -->
                    拭微 &copy;Copyright
                        <script>
                            var date = new Date();
                            document.write("" + date.getFullYear());
                        </script>
                        <!-- | Powered by <a href="https://coding.net" target="_blank">Coding.net</a> -->
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.6.2
                </div>
                
                    <script>
                        var pat = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + pat + '</div>')
                    </script>

        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    

                    function LoadPlayer() {
                        var audio_name = 'きっとまたいつか';
                        var audio_artist = 'DEPAPEPE';
                        var audio_url = 'http://music.163.com/song/media/outer/url?id=22688472.mp3';
                        var audio_cover = 'https://p3fx.kgimg.com/stdmusic/20150718/20150718063022611128.jpg';
                        const ap = new APlayer({
                            container: document.getElementById('player'),
                            fixed: true,
                            audio: [{
                                name: audio_name,
                                artist: audio_artist,
                                url: audio_url,
                                cover: audio_cover,
                            }]
                        });
                    }
                    LoadPlayer();
                    
                    
                    loadlive2d();
                    
                    // hitokoto();
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>